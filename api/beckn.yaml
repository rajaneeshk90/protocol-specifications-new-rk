openapi: 3.1.1
info:
  title: Beckn Protocol API
  description: |
    A unified OpenAPI specification for the Beckn Protocol covering:
    - Discovery: Search and discover items across multiple schemas
    - Transaction: Order lifecycle (select, init, confirm, update, cancel, status, track, support, rating)
    - Catalog Publish: Asynchronous catalog ingestion for Discovery Service

    This specification combines the Discovery API, Transaction API, and Catalog Publish API into a single comprehensive document.
  version: 2.0.0
  contact:
    name: Beckn Protocol
    url: https://becknprotocol.io
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://staging-api.becknprotocol.io
    description: Staging server
  - url: http://localhost:8080
    description: Local development server

paths:
  /beckn/discover:
    get:
      summary: Discover items across multiple schemas
      description: |
        Search and discover items across any schemas in Beckn Schema registry. Supports text search, JSONPath-based filtering (RFC 9535), or both together with automatic schema adaptation. This endpoint may return either an **ACK/NACK** confirming receipt/validation or a synchronous **DiscoverResponse** providing discovery results in catalog format. Networks may still choose to deliver results asynchronously via **/beckn/on_discover**.
      operationId: discoverItems
      tags: [Discovery]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiscoverRequest'
            examples:
              structured_query:
                $ref: '#/components/examples/discover_structured_query'
              natural_language:
                $ref: '#/components/examples/discover_natural_language'
              grocery_search:
                $ref: '#/components/examples/discover_grocery_search'
              combined_search:
                $ref: '#/components/examples/discover_combined_search'
              multi_schema_search:
                $ref: '#/components/examples/discover_multi_schema_search'
      responses:
        '200':
          description: ACK — received the discover request (validation passed)
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/AckResponse'
                  - $ref: '#/components/schemas/DiscoverResponse'
              examples:
                discover_electronics_catalog:
                  $ref: '#/components/examples/on_discover_electronics_catalog'
                discover_grocery_catalog:
                  $ref: '#/components/examples/on_discover_grocery_catalog'
                success_ack:
                  $ref: '#/components/examples/ack_success'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_discover:
    post:
      summary: On Discover response with catalog data
      description: |
        Callback endpoint that provides the actual discovery results in catalog format. This endpoint is called by the BPP to return the search results after processing the discover request. **This endpoint returns only an ACK/NACK** confirming receipt and validation of the catalog payload.
      operationId: onDiscoverItems
      tags: [Discovery]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiscoverResponse'
            examples:
              electronic_items_catalog:
                $ref: '#/components/examples/on_discover_electronics_catalog'
              grocery_items_catalog:
                $ref: '#/components/examples/on_discover_grocery_catalog'
      responses:
        '200':
          description: ACK — received catalog data for the corresponding discover request
          content:
            application/json:
              schema:
                $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/AckResponse'
              examples:
                success_ack:
                  $ref: '#/components/examples/ack_success'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/discover/browser-search:
    get:
      summary: Browser-friendly search API
      description: |
        URL-based search API for browser navigation and direct links using JSONPath expressions.
        Response format is determined by the Accept header:
        - Accept: text/html → Returns browser-friendly HTML page (default)
        - Accept: application/json → Returns structured JSON data in same format as structured query API

        Supports complex filtering via URL-encoded JSONPath expressions.
        Generic search across all entity types (items, providers, catalogs) based on filter criteria.
      operationId: browserSearch
      tags: [Browser Search]
      parameters:
        - name: Accept
          in: header
          required: false
          schema:
            type: string
            enum: ["text/html", "application/json"]
            default: "text/html"
          description: |
            Response format preference.
            - Accept: text/html → Returns browser-friendly HTML page (default)
            - Accept: application/json → Returns structured JSON data in same format as structured query API
          examples:
            default:
              value: "text/html"
        - name: filters
          in: query
          required: false
          schema:
            type: string
          description: URL-encoded JSONPath expression for complex filtering
          examples:
            sample:
              value: "%24%5B%3F%28%40.price%20%3C%3D%201000%20%26%26%20%40.brand%20%3D%3D%20%27Premium%20Tech%27%29%5D"
      responses:
        '200':
          description: Successful search response
          content:
            text/html:
              schema:
                type: string
              examples:
                html_example:
                  summary: Browser-friendly HTML page
                  value: |
                    Search Results - Premium Tech Electronics | Beckn Catalog
                    Search

                    # Premium Tech Electronics Store

                    High-quality electronics and gaming equipment

                    Available from Jan 27, 2025 to Dec 31, 2026

                    ## Premium Gaming Laptop Pro

                    High-performance gaming laptop with RTX graphics

                    ★★★★★ 4.8 (156 reviews)

                    $1,499.99 USD

                    Brand: Premium Tech

                    ID: laptop-item-001

                    © 2024 Beckn Catalog. Powered by Beckn Protocol.
            application/json:
              schema:
                $ref: '#/components/schemas/DiscoverResponse'
              examples:
                electronic_items:
                  $ref: '#/components/examples/browser_search_electronic_items'
        '400':
          description: Bad request - Invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_entity_type:
                  summary: Invalid entity type error
                  description: Error when entity_type is missing or invalid
                  value:
                    error:
                      code: "INVALID_ENTITY_TYPE"
                      message: "entity_type is required and must be one of: item, provider, catalog"
        '404':
          description: No results found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                no_results:
                  summary: No results found error
                  description: Error when no items match the search criteria
                  value:
                    error:
                      code: "NO_RESULTS_FOUND"
                      message: "No items found matching the specified criteria"
                      details:
                        search_criteria:
                          entity_type: "item"
                          category: "electric_vehicles"
                          price_max: 50000
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /beckn/discover/offer:
    post:
      summary: Compute/prune final offers for a given selection of items and/or offers (no Order envelope)
      description: >
        Client (BAP) submits a selection of items and/or offers. The BPP computes applicable, priced offers and returns them asynchronously via /beckn/on_discover/offer. This is semantically similar to /select, but avoids the Order wrapper to keep the intent clear: "give me offers for these choices".

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [context, message]
              properties:
                context:
                  allOf:
                    - $ref: "#/components/schemas/DiscoveryContext"
                    - type: object
                      properties: {action: {const: "discover_offer"}}
                message:
                  type: object
                  required: [selection]
                  properties:
                    # The selection may be a set of items, a set of offers, or both.
                    selection:
                      type: object
                      properties:
                        items:
                          type: array
                          minItems: 1
                          items:
                            type: object
                            required: ['beckn:id']
                            properties:
                              beckn:id:
                                $ref: "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Item/properties/beckn:id"
                              quantity:
                                type: number
                                description: Optional requested quantity for this item
                        offers:
                          type: array
                          minItems: 1
                          items:
                            type: object
                            required: ['beckn:id']
                            properties:
                              beckn:id:
                                $ref: "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Offer/properties/beckn:id"
                      anyOf:
                        - required: [items]
                        - required: [offers]
                    # Optional scoping hints (kept open; networks can define attribute packs if needed)
                    provider:
                      $ref: "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Provider/properties/beckn:id"
                    constraints:
                      type: object
                      description: Optional constraints (e.g., fulfillment mode/slots, region, eligibility). Extend via attribute packs as needed.
                      additionalProperties: true
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_discover/offer:
    post:
      summary: Provider returns computed offers for the selection
      description: >
        BPP responds with the final set of offers applicable to the submitted selection. Each Offer must reference the base items via beckn:items (schema:itemOffered). Additional pricing/eligibility details can be carried in offerAttributes packs.

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [context, message]
              properties:
                context:
                  allOf:
                    - $ref: "#/components/schemas/DiscoveryContext"
                    - type: object
                      properties: {action: {const: "on_discover_offer"}}
                message:
                  type: object
                  required: [offers]
                  properties:
                    # Full Offer objects are returned (not just ids) so clients can render price/terms immediately.
                    offers:
                      type: array
                      minItems: 1
                      items:
                        $ref: "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Offer"
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/select:
    post:
      summary: "Buyer selects items/offers — returns priced order"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: select
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_select:
    post:
      summary: Provider returns priced order (quote)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: on_select
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/init:
    post:
      summary: Initialize order (party details, fulfillment mode, payment intent)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: init
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_init:
    post:
      summary: Provider echoes initialized order (with refs populated)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: on_init
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/confirm:
    post:
      summary: Confirm order (final selections; payment/fulfillment committed)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: confirm
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_confirm:
    post:
      summary: Provider returns confirmed order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: on_confirm
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/status:
    post:
      summary: Fetch order status by id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: status
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      oneOf:
                        - type: object
                          required:
                            - beckn:id
                          properties:
                            beckn:id:
                              $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order/properties/beckn:id'
                        - $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_status:
    post:
      summary: Provider returns current order (or tracking via fulfillment packs)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: on_status
                message:
                  type: object
                  properties:
                    order:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
                  anyOf:
                    - required:
                        - order
                    - required: []
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/update:
    post:
      summary: Request order mutation (replace, cancel line, address change, etc.)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: update
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_update:
    post:
      summary: Provider returns mutated order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: on_update
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/cancel:
    post:
      summary: Request to cancel an order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: cancel
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      oneOf:
                        - type: object
                          required:
                            - beckn:id
                          properties:
                            beckn:id:
                              $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order/properties/beckn:id'
                            beckn:orderItems:
                              type: array
                              minItems: 1
                              items:
                                oneOf:
                                  - type: object
                                    required:
                                      - beckn:orderedItem
                                    properties:
                                      beckn:orderedItem:
                                        $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Item/properties/beckn:id'
                                      beckn:lineId:
                                        type: string
                                        description: Unique line id within order
                                      beckn:quantity:
                                        $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Quantity'
                                  - $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/OrderItem'
                        - $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_cancel:
    post:
      summary: Provider returns cancelled order (may reflect refund/payment update via PaymentRef)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - context
                - message
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: on_cancel
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/support:
    post:
      summary: Request support details for an entity (order/item/provider/etc.)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [context, message]
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: support
                message:
                  type: object
                  required: [ref_id]
                  properties:
                    ref_id:
                      type: string
                      description: ID of the entity for which support is requested (order/item/fulfillment/provider/agent). # legacy kept minimal
                    ref_type:
                      type: string
                      description: Optional hint to help route support.
                      enum: [order, fulfillment, item, provider, agent, other]
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_support:
    post:
      summary: Provider returns support details
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [context, message]
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: on_support
                message:
                  type: object
                  required: [support]
                  properties:
                    support:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/SupportInfo'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/track:
    post:
      summary: Request tracking handle/link for an active order/fulfillment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [context, message]
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: track
                message:
                  type: object
                  required:
                    - order
                  properties:
                    order:
                      oneOf:
                        - type: object
                          required:
                            - beckn:id
                          properties:
                            beckn:id:
                              $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order/properties/beckn:id'
                            fulfillment:
                              oneOf:
                                - type: object
                                  properties:
                                    beckn:id:
                                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Fulfillment/properties/beckn:id'
                                - $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Fulfillment'
                        - $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
                    mode_hint:
                      type: string
                      description: Optional delivery mode for the tracking handle.
                      enum: [link_only, deep_link, webhook, ws_handle]
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_track:
    post:
      summary: Provider returns tracking handle/link and status
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [context, message]
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: on_track
                message:
                  type: object
                  required: [tracking]
                  properties:
                    tracking:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Tracking'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/rating:
    post:
      summary: Submit a rating (optionally with feedback) for an entity
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [context, message]
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: rating
                message:
                  $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/RatingInput'
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/on_rating:
    post:
      summary: Provider acknowledges/returns rating receipt (optional aggregate snapshot)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [context, message]
              properties:
                context:
                  allOf:
                    - $ref: '#/components/schemas/TransactionContext'
                    - type: object
                      properties:
                        action:
                          const: on_rating
                message:
                  type: object
                  properties:
                    received:
                      type: boolean
                      default: true
                    aggregate:
                      type: object
                      description: Optional current aggregate rating snapshot.
                      properties:
                        count:
                          type: integer
                          minimum: 0
                        value:
                          type: number
                          minimum: 0
                        best:
                          type: number
                          minimum: 0
                        worst:
                          type: number
                          minimum: 0
                    feedbackForm:
                      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Form'
                      description: Optional feedback form for additional detailed feedback collection
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/v2/catalog/publish:
    post:
      summary: Publish one or more catalogs for indexing
      description: |
        BPP submits catalogs to be indexed. Returns **ACK** immediately if accepted for processing.
        The detailed per-catalog processing result arrives later via **/on_catalog_publish**.
      operationId: publishCatalogs
      tags: [Catalog Publish]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CatalogPublishRequest'
            examples:
              publish_basic:
                summary: Minimal publish
                value:
                  context:
                    version: "2.0.0"
                    action: "catalog_publish"
                    timestamp: "2025-09-01T10:30:00+05:30"
                    message_id: "u-req-123"
                    transaction_id: "u-txn-123"
                    bap_id: "bpp.example.com"
                    bap_uri: "https://bpp.example.com/callbacks" # where /on_catalog_publish is exposed
                    ttl: "PT30S"
                  catalogs:
                    - "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingOffer/v1/context.jsonld"
                      "@type": "beckn:Catalog"
                      "beckn:id": "catalog-001"
                      "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "BPP Test Catalog"}
                      "beckn:items": []
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
  /beckn/v2/catalog/on_publish:
    post:
      summary: Callback with catalog publish processing results
      description: |
        Discovery Service calls back with per-catalog processing results (accepted/rejected, errors, derived stats).
        The receiver should respond with an **AckResponse**.
      operationId: onCatalogPublish
      tags: [Catalog Publish]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CatalogPublishResponse'
            examples:
              results_basic:
                summary: Example processing results
                value:
                  context:
                    version: "2.0.0"
                    action: "on_catalog_publish"
                    timestamp: "2025-09-01T10:31:05+05:30"
                    message_id: "u-resp-123"
                    transaction_id: "u-txn-123"
                    bpp_id: "discovery-indexer.example.com"
                    bpp_uri: "https://discovery-indexer.example.com"
                    ttl: "PT30S"
                  results:
                    - catalog_id: "catalog-001"
                      status: "ACCEPTED"
                      item_count: 42
                      warnings:
                        - code: "NON_NORMALIZED_BRAND"
                          message: "Some brand values were normalized"
                    - catalog_id: "catalog-002"
                      status: "REJECTED"
                      error:
                        code: "INVALID_ITEM"
                        message: "Invalid item payload at index 3"
                        paths: "catalogs[1].items[3]"
      responses:
        '200':
          $ref: '#/components/responses/Ack200'
        '400':
          $ref: '#/components/responses/Ack400'
        '500':
          $ref: '#/components/responses/Ack500'
components:
  schemas:
    DiscoverRequest:
      type: object
      required: [context]
      properties:
        context:
          allOf:
            - $ref: '#/components/schemas/DiscoveryContext'
            - type: object
              properties:
                action:
                  type: string
                  enum: [discover]
        message:
          type: object
          description: Discover payload containing search criteria
          properties:
            text_search:
              type: string
              description: Free text search query for items
              example: "gaming laptop premium tech"
            filters:
              type: object
              description: Filter criteria for items
              properties:
                type:
                  type: string
                  enum: [jsonpath]
                  default: jsonpath
                  description: Type of filter expression
                expression:
                  type: string
                  description: Filter expression based on the specified type
                  example: "$[?(@.rating.value >= 4.0 && @.electronic.brand.name == 'Premium Tech')]"
              required: [type, expression]
            spatial:
              type: array
              description: Optional array of spatial constraints (CQL2-JSON semantics).
              items:
                $ref: '#/components/schemas/SpatialConstraint'
            media_search:
              $ref: '#/components/schemas/MediaSearch'
          anyOf:
            - required: [text_search]
            - required: [filters]
            - required: [spatial]
            - required: [filters, spatial]
    DiscoverResponse:
      type: object
      required: [context, message]
      properties:
        context:
          allOf:
            - $ref: '#/components/schemas/DiscoveryContext'
            - type: object
              properties:
                action:
                  type: string
                  enum: [on_discover]
        message:
          type: object
          properties:
            catalogs:
              type: array
              description: Array of catalogs containing items
              items:
                $ref: '#/components/schemas/Catalog'
    DiscoveryContext:
      allOf:
        - $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications/refs/heads/master/api/transaction/build/transaction.yaml#/components/schemas/Context'
        - type: object
          description: Beckn Context extended for Discovery.
          properties:
            schema_context:
              type: array
              items:
                type: string
                format: uri
              description: Optional JSON-LD context URLs indicating item types to search across
    GeoJSONGeometry:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/GeoJSONGeometry'
    Address:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Address'
    Location:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Location'
    SpatialConstraint:
      type: object
      description: >
        **Spatial predicate** using **OGC CQL2 (JSON semantics)** applied to one or more geometry targets in an item. This is where clients express spatial intent.

        Key ideas: - `targets`: one or more **JSONPath-like** pointers that locate geometry

          fields within each item document (e.g., `$['beckn:availableAt'][*]['geo']`).
        - `op`: spatial operator (CQL2). Common ones:

            • `s_within`     (A is completely inside B)
            • `s_intersects` (A intersects B)
            • `s_contains`   (A contains B)
            • `s_dwithin`    (A within distance of B)
        - `geometry`: **GeoJSON** literal used as the predicate reference geometry. - `distanceMeters`: required for `s_dwithin` when using a GeoJSON Point/shape. - `quantifier`: if a target resolves to an array, choose whether **any** (default),

          **all**, or **none** of elements must satisfy the predicate.

        CRS: unless otherwise stated, all coordinates are **EPSG:4326**.

      required: [op, targets]
      properties:
        op:
          type: string
          enum:
            - s_within
            - s_contains
            - s_intersects
            - s_disjoint
            - s_overlaps
            - s_crosses
            - s_touches
            - s_equals
            - s_dwithin
          description: OGC CQL2 spatial operator.
        targets:
          description: >
            One or more JSONPath-like pointers to geometry fields within the item. Example pointers: - `$['beckn:availableAt'][*]['geo']` (array of site Points) - `$['beckn:itemAttributes']['ride:dropOff']['geo']` (drop zone Polygon)

          oneOf:
            - type: string
            - type: array
              items: {type: string}
        geometry:
          $ref: '#/components/schemas/GeoJSONGeometry'
        distanceMeters:
          type: number
          minimum: 0
          description: >
            For `s_dwithin`: maximum distance in meters from the target geometry to `geometry` (e.g., “within 5000 m of this Point”). Ignored for other ops.

        quantifier:
          type: string
          enum: [any, all, none]
          default: any
          description: >
            How to evaluate when `targets` resolves to an array: - **any**: at least one element matches (default) - **all**: every element must match - **none**: no element may match

        srid:
          type: string
          description: >
            Coordinate Reference System identifier for `geometry`. Default is `"EPSG:4326"`. If provided, servers MAY reproject to EPSG:4326 internally.

          example: "EPSG:4326"
      additionalProperties: false
      examples:
        within_circle_as_distance:
          summary: EV sites within 5 km of a center (via s_dwithin)
          value:
            op: s_dwithin
            targets: "$['beckn:availableAt'][*]['geo']"
            geometry:
              type: Point
              coordinates: [77.5946, 12.9716]
            distanceMeters: 5000
        pickup_at_point:
          summary: Pickup at a defined point (GeoJSON Point)
          description: >
            Example of a DiscoverRequest spatial constraint representing a specific pickup location. The requester defines a GeoJSON Point as the pickup location, and the server finds providers whose service area **contains** this point.

          value:
            op: s_contains
            targets: "$['beckn:itemAttributes']['ride:serviceArea']['geo']" # provider polygon field
            geometry:
              type: Point
              coordinates: [77.5946, 12.9716] # MG Road (Bengaluru) — [lon, lat]              
        drop_intersects_user_box:
          summary: Provider drop zone intersects user’s rectangle
          value:
            op: s_intersects
            targets: "$['beckn:itemAttributes']['ride:dropOff']['geo']"
            geometry:
              type: Polygon
              coordinates:
                - [[77.6100, 12.9200], [77.6400, 12.9200], [77.6400, 12.9500], [77.6100, 12.9500], [77.6100, 12.9200]]
        pickup_location_example:
          summary: A defined pickup location object
          value:
            geo:
              type: Point
              coordinates: [77.5946, 12.9716] # [lon, lat]
            address:
              streetAddress: "MG Road"
              addressLocality: "Bengaluru"
              addressRegion: "Karnataka"
              postalCode: "560001"
              addressCountry: "IN"
    MediaSearch:
      type: object
      description: >
        Container for multimodal search inputs and configuration. Supports searching through **images, audio notes, and videos** alongside text, filters, and spatial predicates. For GET, this object should be JSON-encoded and URL-escaped.

      properties:
        media:
          type: array
          description: >
            One or more references to **images, audio notes, or videos** supplied as part of a multimodal search. Each entry references a media resource accessible via HTTPS or data URI.

          items:
            $ref: '#/components/schemas/MediaInput'
          example:
            - id: "snap-1"
              type: image
              url: "https://cdn.example.com/user/snaps/ccs2-cable.jpg"
              contentType: "image/jpeg"
        options:
          $ref: '#/components/schemas/MediaSearchOptions'
          description: >
            Options controlling how the discovery engine interprets the supplied media — e.g., whether to perform OCR/ASR, semantic similarity, or object detection.

      additionalProperties: false
      example:
        media:
          - id: "snap-1"
            type: image
            url: "https://cdn.example.com/user/snaps/ccs2-cable.jpg"
            contentType: "image/jpeg"
        options:
          goals: ["visual-object-detect", "text-from-image"]
          augment_text_search: true
    MediaInput:
      type: object
      description: Reference to an image, audio clip, or video used for multimodal search.
      required: [type, url]
      properties:
        id:
          type: string
          description: Client-supplied identifier for this media input.
        type:
          type: string
          enum: [image, audio, video]
          description: Media category.
        url:
          type: string
          format: uri
          description: HTTPS URL or data URI pointing to the media resource.
        contentType:
          type: string
          description: MIME type, e.g., image/jpeg, audio/mpeg, video/mp4.
        textHint:
          type: string
          description: Optional pre-extracted text (OCR/ASR) for search augmentation.
        language:
          type: string
          description: Language code (BCP-47) of `textHint` or spoken audio.
        startMs:
          type: integer
          description: Optional start offset in milliseconds (for audio/video segments).
        endMs:
          type: integer
          description: Optional end offset in milliseconds (for audio/video segments).
      additionalProperties: false
    MediaSearchOptions:
      type: object
      description: How the discovery engine should use the provided media inputs.
      properties:
        goals:
          type: array
          description: >
            Desired processing goals for the media.

          items:
            type: string
            enum:
              - visual-similarity # find visually similar items
              - visual-object-detect # detect object classes within image/video
              - text-from-image # extract text (OCR)
              - text-from-audio # extract text (ASR)
              - semantic-audio-match # audio embedding similarity
              - semantic-video-match # video scene/keyframe similarity
        augment_text_search:
          type: boolean
          default: true
          description: >
            Whether to append extracted text from OCR/ASR to `text_search`.

        restrict_results_to_media_proximity:
          type: boolean
          default: false
          description: >
            Restrict results to spatial proximity of media-derived coordinates (e.g., EXIF GPS tags).

      additionalProperties: false
    AckResponse:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/AckResponse'
    Catalog:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Catalog'
    Item:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Item'
    Offer:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Offer'
    Attributes:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Attributes'
    Provider:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Provider'
    PriceSpecification:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/PriceSpecification'
    Eligibility:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Eligibility'
    Descriptor:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Descriptor'
    CategoryCode:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/CategoryCode'
    TimePeriod:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/TimePeriod'
    Rating:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Rating'
    ErrorResponse:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/ErrorResponse'
    Error:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Error'
    TransactionContext:
      allOf:
        - $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications/refs/heads/master/api/transaction/build/transaction.yaml#/components/schemas/Context'
        - type: object
          description: >
            Beckn Context extended for Transaction flows. Mirrors DiscoveryContext pattern to enable validation and per-endpoint action constraints. network_id/schema_context are optional for routing and JSON-LD hints.

          properties:
            network_id:
              type: array
              items: {type: string}
              description: Optional list of addressed networks (for routing/allowlisting)
            schema_context:
              type: array
              items:
                type: string
                format: uri
              description: Optional JSON-LD context URLs relevant to the items/offers in this transaction
    # --------------------------------
    # Core schemas (referenced from attributes.yaml)
    # --------------------------------
    Order:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Order'
    OrderItem:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/OrderItem'
    Invoice:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Invoice'
    Fulfillment:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Fulfillment'
    TrackAction:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/TrackAction'
    Payment:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Payment'
    Buyer:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Buyer'
    SupportInfo:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/SupportInfo'
    Tracking:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Tracking'
    RatingInput:
      $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/RatingInput'
    # ---------- Envelopes ----------
    CatalogPublishRequest:
      type: object
      required: [context, message]
      properties:
        context:
          allOf:
            - $ref: '#/components/schemas/DiscoveryContext'
            - type: object
              properties:
                action:
                  type: string
                  enum: [catalog_publish]
        message:
          type: object
          required: [catalogs]
          properties:
            catalogs:
              type: array
              description: Array of catalogs containing items
              items:
                $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Catalog'
              minItems: 1
      description: |
        Catalog Publish request envelope.
        *context.version* MUST indicate the supported protocol version (e.g., "2.0.0").
    CatalogPublishResponse:
      type: object
      required: [context, results]
      properties:
        context:
          allOf:
            - $ref: '#/components/schemas/DiscoveryContext'
            - type: object
              properties:
                action:
                  type: string
                  enum: [on_catalog_publish]
        message:
          type: object
          properties:
            results:
              type: array
              description: Per-catalog processing results
              items:
                $ref: '#/components/schemas/CatalogProcessingResult'
    # ---------- Result model ----------
    CatalogProcessingResult:
      type: object
      required: [catalog_id, status]
      properties:
        catalog_id:
          type: string
          description: The "beckn:id" of the submitted catalog
        status:
          type: string
          enum: [ACCEPTED, REJECTED, PARTIAL]
          description: Final processing outcome for this catalog
        item_count:
          type: integer
          minimum: 0
          description: Number of items indexed (when accepted/partial)
        warnings:
          type: array
          description: Non-fatal issues encountered
          items:
            $ref: '#/components/schemas/ProcessingNotice'
        error:
          $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/Error'
    ProcessingNotice:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true
  examples:
    # ---------- /discover request examples ----------
    discover_structured_query:
      summary: Structured discover (electronics)
      value:
        context:
          version: "2.0.0"
          action: "discover"
          timestamp: "2024-04-10T16:10:50+05:30"
          message_id: "5c8f1a2b-9d3e-4f76-8b21-3a4c5d6e7f80"
          transaction_id: "d3b07384-4a1c-4f5e-9c2b-7e6d5c4b3a21"
          bap_id: "bap.example.com"
          bap_uri: "https://bap.example.com"
          ttl: "PT30S"
          schema_context:
            - "https://example.org/schema/items/v1/ElectronicItem/schema-context.jsonld"
        message:
          text_search: "gaming laptop premium tech"
          filters:
            type: "jsonpath"
            expression: "$[?(@.rating.value >= 4 && @.electronic.brand.name == 'Premium Tech')]"
    discover_natural_language:
      summary: Natural-language discover (electronics)
      value:
        context:
          version: "2.0.0"
          action: "discover"
          timestamp: "2024-04-10T16:10:50+05:30"
          message_id: "9a7b6c5d-8e4f-4a3b-9c2d-1e0f2a3b4c5d"
          transaction_id: "1f2e3d4c-5b6a-4789-8c0d-1a2b3c4d5e6f"
          bap_id: "bap.example.com"
          bap_uri: "https://bap.example.com"
          ttl: "PT30S"
          schema_context:
            - "https://example.org/schema/items/v1/ElectronicItem/schema-context.jsonld"
        message:
          text_search: "Looking for a premium gaming laptop under $2000 near San Francisco"
    discover_grocery_search:
      summary: Structured discover (grocery)
      value:
        context:
          version: "2.0.0"
          action: "discover"
          timestamp: "2024-04-10T16:10:50+05:30"
          message_id: "2a3b4c5d-6e7f-4890-9a1b-2c3d4e5f6071"
          transaction_id: "7e6d5c4b-3a21-4c5d-8f70-9a1b2c3d4e5f"
          bap_id: "bap.example.com"
          bap_uri: "https://bap.example.com"
          ttl: "PT30S"
          schema_context:
            - "https://example.org/schema/items/v1/GroceryItem/schema-context.jsonld"
        message:
          text_search: "organic apples fresh"
          filters:
            type: "jsonpath"
            expression: "$[?(@.grocery.organicCertification ~ 'USDA Organic')]"
    discover_combined_search:
      summary: Combined text + filters
      value:
        context:
          version: "2.0.0"
          action: "discover"
          timestamp: "2024-04-10T16:10:50+05:30"
          message_id: "3b4c5d6e-7f80-41a2-93b4-c5d6e7f8091a"
          transaction_id: "8f70e6d5-c4b3-42a1-9c2d-3e4f5a6b7c8d"
          bap_id: "bap.example.com"
          bap_uri: "https://bap.example.com"
          ttl: "PT30S"
          schema_context:
            - "https://example.org/schema/items/v1/ElectronicItem/schema-context.jsonld"
        message:
          text_search: "gaming laptop"
          filters:
            type: "jsonpath"
            expression: "$[?(@.electronic.price['schema:price'] <= 2000 && @.electronic.brand.name == 'Premium Tech')]"
    discover_multi_schema_search:
      summary: Multi-schema discover (electronics + grocery)
      value:
        context:
          version: "2.0.0"
          action: "discover"
          timestamp: "2024-04-10T16:10:50+05:30"
          message_id: "4c5d6e7f-8091-42b3-94c5-d6e7f8091a2b"
          transaction_id: "9c2d3e4f-5a6b-47c8-8d90-1a2b3c4d5e6f"
          bap_id: "bap.example.com"
          bap_uri: "https://bap.example.com"
          ttl: "PT30S"
          schema_context:
            - "https://example.org/schema/items/v1/ElectronicItem/schema-context.jsonld"
            - "https://example.org/schema/items/v1/GroceryItem/schema-context.jsonld"
        message:
          text_search: "premium tech and organic food"
          filters:
            type: "jsonpath"
            expression: "$[?(@.rating.value >= 4 && (@.electronic.brand.name == 'Premium Tech' || @.grocery.organicCertification ~ 'USDA Organic'))]"
    # ---------- /on_discover callback (DiscoverResponse) examples ----------
    on_discover_electronics_catalog:
      summary: Electronics catalog callback
      value:
        context:
          version: "2.0.0"
          action: "on_discover"
          timestamp: "2024-04-10T16:10:50+05:30"
          message_id: "a1b2c3d4-e5f6-4789-90ab-cdef12345678"
          transaction_id: "b2c3d4e5-f6a7-4890-8b9a-cdef23456789"
          bpp_id: "bpp.example.com"
          bpp_uri: "https://bpp.example.com"
          ttl: "PT30S"
        message:
          catalogs:
            - "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
              "@type": "beckn:Catalog"
              "beckn:id": "catalog-electronics-001"
              "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "Premium Tech Electronics Store"}
              "beckn:items": [{"@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld", "@type": "beckn:Item", "beckn:id": "laptop-item-002", "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "Premium Gaming Laptop Pro 15”", "beckn:shortDesc": "Intel i7, 16GB RAM, 512GB SSD, RTX 4060"}, "beckn:category": {"@type": "schema:CategoryCode", "schema:codeValue": "electronics", "schema:name": "Electronics"}, "beckn:rateable": true, "beckn:rating": {"@type": "beckn:Rating", "beckn:ratingValue": 4.7, "beckn:ratingCount": 932}, "beckn:networkId": ["bap.net/electronics"], "beckn:itemAttributes": {"@context": "https://example.org/schema/items/v1/ElectronicItem/schema-context.jsonld", "@type": "beckn:ElectronicItem", "electronic:brand": "Premium Tech", "electronic:model": "G15-Pro-2025", "electronic:processor": "Intel Core i7-13700H", "electronic:ram": "16GB DDR5", "electronic:storage": "512GB NVMe SSD", "electronic:graphics": "NVIDIA GeForce RTX 4060", "electronic:display": "15.6\" 240Hz QHD", "electronic:warranty": "24 months"}, "beckn:provider": {"beckn:id": "tech-store-001", "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "Premium Tech Electronics Store"}}}, {"@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld", "@type": "beckn:Item", "beckn:id": "headphones-item-001", "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "Aurora X200 Noise-Cancelling Headphones", "beckn:shortDesc": "Over-ear ANC, 40h battery, BT 5.3, multipoint"}, "beckn:category": {"@type": "schema:CategoryCode", "schema:codeValue": "electronics", "schema:name": "Electronics"}, "beckn:rateable": true, "beckn:rating": {"@type": "beckn:Rating", "beckn:ratingValue": 4.5, "beckn:ratingCount": 1543}, "beckn:networkId": ["bap.net/electronics"], "beckn:itemAttributes": {"@context": "https://example.org/schema/items/v1/ElectronicItem/schema-context.jsonld", "@type": "beckn:ElectronicItem", "electronic:brand": "Aurora", "electronic:model": "X200", "electronic:wirelessTech": "Bluetooth 5.3", "electronic:features": ["ANC", "Transparency Mode", "Multipoint"], "electronic:batteryLifeHours": 40, "electronic:chargingPort": "USB-C", "electronic:warranty": "12 months"}, "beckn:provider": {"beckn:id": "tech-store-001", "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "Premium Tech Electronics Store"}}}]
    on_discover_grocery_catalog:
      summary: Grocery catalog callback
      value:
        context:
          version: "2.0.0"
          action: "on_discover"
          timestamp: "2024-04-10T16:10:50+05:30"
          message_id: "c3d4e5f6-a7b8-49c0-9dab-ef1234567890"
          transaction_id: "d4e5f6a7-b8c9-4ad1-8cab-1234567890ef"
          bpp_id: "bpp.example.com"
          bpp_uri: "https://bpp.example.com"
          ttl: "PT30S"
        message:
          catalogs:
            - "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
              "@type": "beckn:Catalog"
              "beckn:id": "catalog-grocery-001"
              "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "Fresh Grocery Store"}
              "beckn:items": [{"@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld", "@type": "beckn:Item", "beckn:id": "apples-item-001", "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "Organic Fuji Apples (1 kg)", "beckn:shortDesc": "Crisp, sweet USDA Organic apples — farm fresh"}, "beckn:category": {"@type": "schema:CategoryCode", "schema:codeValue": "grocery", "schema:name": "Grocery"}, "beckn:rateable": true, "beckn:rating": {"@type": "beckn:Rating", "beckn:ratingValue": 4.6, "beckn:ratingCount": 387}, "beckn:networkId": ["bap.net/grocery"], "beckn:itemAttributes": {"@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld", "@type": "beckn:GroceryItem", "grocery:brand": "Fresh Fields", "grocery:organicCertification": "USDA Organic", "grocery:variety": "Fuji", "grocery:unitSize": "1 kg", "grocery:origin": "Himachal Pradesh, IN", "grocery:shelfLifeDays": 10}, "beckn:provider": {"beckn:id": "grocery-store-001", "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "Fresh Grocery Store"}}}, {"@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld", "@type": "beckn:Item", "beckn:id": "bread-item-001", "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "Whole Wheat Bread (500 g)", "beckn:shortDesc": "High-fiber artisan loaf, no added sugar"}, "beckn:category": {"@type": "schema:CategoryCode", "schema:codeValue": "grocery", "schema:name": "Grocery"}, "beckn:rateable": true, "beckn:rating": {"@type": "beckn:Rating", "beckn:ratingValue": 4.3, "beckn:ratingCount": 812}, "beckn:networkId": ["bap.net/grocery"], "beckn:itemAttributes": {"@context": "https://example.org/schema/items/v1/GroceryItem/schema-context.jsonld", "@type": "beckn:GroceryItem", "grocery:brand": "BakeHouse", "grocery:unitSize": "500 g", "grocery:ingredients": ["Whole wheat flour", "Yeast", "Salt", "Olive oil"], "grocery:allergens": ["Gluten"], "grocery:shelfLifeDays": 5}, "beckn:provider": {"beckn:id": "grocery-store-001", "beckn:descriptor": {"@type": "beckn:Descriptor", "schema:name": "Fresh Grocery Store"}}}]
    # ---------- ACK / NACK examples ----------
    ack_success:
      summary: ACK
      value:
        transaction_id: "e5f6a7b8-c9d0-4e1f-9a2b-3c4d5e6f7081"
        timestamp: "2024-04-10T16:10:50+05:30"
        ack_status: "ACK"
    ack_bad_request:
      summary: NACK — bad request
      value:
        transaction_id: "f6a7b8c9-d0e1-42f3-8a2b-3c4d5e6f7081"
        timestamp: "2024-04-10T16:10:50+05:30"
        ack_status: "NACK"
        error:
          code: "INVALID_REQUEST"
          paths: "context.schema_context"
          message: "Invalid schema context provided"
    ack_server_error:
      summary: NACK — internal error
      value:
        transaction_id: "a7b8c9d0-e1f2-43a4-9b2c-3d4e5f607081"
        timestamp: "2024-04-10T16:10:50+05:30"
        ack_status: "NACK"
        error:
          code: "INTERNAL_ERROR"
          paths: "server"
          message: "Internal server error occurred"
    # ---------- /discover/browser-search JSON example ----------
    browser_search_electronic_items:
      summary: Browser-search JSON response (electronics)
      value:
        id: "api.beckn.discover.browser-search"
        ver: "v2"
        ts: "2024-04-10T16:10:50+05:30"
        params:
          msgid: "0a1b2c3d-4e5f-6789-8a0b-1c2d3e4f5a6b"
          traceid: "1b2c3d4e-5f60-4781-92a3-b4c5d6e7f809"
        response:
          context:
            version: "2.0.0"
            action: "on_discover"
          catalogs:
            - "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
              "@type": "beckn:Catalog"
              "beckn:id": "catalog-electronics-001"
              "beckn:descriptor":
                "@type": "beckn:Descriptor"
                "schema:name": "Premium Tech Electronics Store"
                "beckn:shortDesc": "High-quality electronics and gaming equipment"
              "beckn:validity":
                "@type": "beckn:TimePeriod"
                "schema:startDate": "2025-01-27T09:00:00Z"
                "schema:endDate": "2026-12-31T23:59:59Z"
              "beckn:items":
                - "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                  "@type": "beckn:Item"
                  "beckn:id": "laptop-item-001"
                  "beckn:descriptor":
                    "@type": "beckn:Descriptor"
                    "schema:name": "Premium Gaming Laptop Pro"
                    "beckn:shortDesc": "High-performance gaming laptop with RTX graphics"
                  "beckn:category":
                    "@type": "schema:CategoryCode"
                    "schema:codeValue": "electronics"
                    "schema:name": "Electronics"
                  "beckn:rating":
                    "@type": "beckn:Rating"
                    "beckn:ratingValue": 4.8
                    "beckn:ratingCount": 156
                  "beckn:rateable": true
                  "beckn:networkId": ["bap.net/electronics"]
                  "beckn:itemAttributes":
                    "@context": "https://example.org/schema/items/v1/ElectronicItem/schema-context.jsonld"
                    "@type": "beckn:ElectronicItem"
                    "electronic:brand": "ASUS"
                    "electronic:model": "ROG Strix G15"
                    "electronic:processor": "Intel Core i7-12700H"
                    "electronic:ram": "16GB DDR4"
                    "electronic:storage": "512GB NVMe SSD"
                    "electronic:graphics": "NVIDIA RTX 3060"
                  "beckn:provider":
                    "beckn:id": "tech-store-001"
                    "beckn:descriptor":
                      "@type": "beckn:Descriptor"
                      "schema:name": "Premium Tech Store"
  responses:
    Ack200:
      description: "ACK — request received (validation passed)"
      content:
        application/json:
          schema:
            $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/AckResponse'
          examples:
            success_ack:
              $ref: '#/components/examples/ack_success'
    Ack400:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/AckResponse'
          examples:
            bad_request:
              $ref: '#/components/examples/ack_bad_request'
    Ack500:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: 'https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/attributes.yaml#/components/schemas/AckResponse'
          examples:
            server_error:
              $ref: '#/components/examples/ack_server_error'
